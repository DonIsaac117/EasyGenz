{
  "controllers": {
    "usuariosController.php": "<?php\r\n\r\nrequire_once './config/ConexionBd.php';\r\nrequire_once './models/Usuarios.php';\r\nrequire_once './models/Registros.php';\r\n\r\nclass UsuarioController {  \r\n    private $usuarioModel;\r\n   \r\n\r\n    public function __construct() {\r\n        $this->usuarioModel = new Usuarios();\r\n    }\r\n    \r\n    public function listar() {\r\n        return $this->usuarioModel->listAll();\r\n    }\r\n\r\n    public function registrar() {\r\n        if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n            $this->usuarioModel->setNombres($_POST['nombre']);\r\n            $this->usuarioModel->setApellidos($_POST['apellidos']);\r\n            $this->usuarioModel->setTipoDocumento($_POST['tipo_doc']);\r\n            $this->usuarioModel->setNumeroDocumento($_POST['num_doc']);\r\n            $this->usuarioModel->setTelefono($_POST['telefono']);\r\n            $this->usuarioModel->setEmail($_POST['email']);\r\n            $this->usuarioModel->setContraseña($_POST['contrasena']);\r\n            $this->usuarioModel->setRh($_POST['tipo-sangre']);\r\n            $this->usuarioModel->setEps($_POST['eps']);\r\n            $this->usuarioModel->setContactoEmergencia($_POST['contacto-emer']);\r\n            $this->usuarioModel->setEnfermedades($_POST['enfermedades']);\r\n            $this->usuarioModel->setAlergias($_POST['alergias']);\r\n\r\n            $this->usuarioModel->insertar();\r\n            header('Location: index.php?vista=usuario/login');\r\n        } else {\r\n            echo \"Error: La solicitud no es de tipo POST.\";\r\n        }\r\n    }\r\n\r\n    public function eliminar() {\r\n        if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['eliminar'])) {\r\n            $id = intval($_POST['eliminar']);\r\n            $this->usuarioModel->eliminar($id);\r\n            header(\"Location: index.php?vista=usuario/inicio\");\r\n            exit();\r\n        }\r\n    }\r\n\r\n\r\n    public function actualizar() {\r\n        if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n            $this->usuarioModel->setId($_POST['id']);\r\n            $this->usuarioModel->setNombres($_POST['nombre']);\r\n            $this->usuarioModel->setApellidos($_POST['apellidos']);\r\n            $this->usuarioModel->setTipoDocumento($_POST['tipo_doc']);\r\n            $this->usuarioModel->setNumeroDocumento($_POST['num_doc']);\r\n            $this->usuarioModel->setTelefono($_POST['telefono']);\r\n            $this->usuarioModel->setEmail($_POST['email']);\r\n            $this->usuarioModel->setContraseña($_POST['contrasena']);\r\n            $this->usuarioModel->setRh($_POST['tipo_sangre']);\r\n            $this->usuarioModel->setEps($_POST['eps']);\r\n            $this->usuarioModel->setContactoEmergencia($_POST['contacto_emer']);\r\n            $this->usuarioModel->setEnfermedades($_POST['enfermedades']);\r\n            $this->usuarioModel->setAlergias($_POST['alergias']);\r\n    \r\n            $this->usuarioModel->actualizar();\r\n            header('Location: index.php?vista=usuario/inicio');\r\n        } else {\r\n            echo \"Error: La solicitud no es de tipo POST.\";\r\n        }\r\n    }\r\n\r\n    public function login() {\r\n        if ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n            $numero_documento = $_POST['documento'];\r\n            $contrasena = $_POST['contrasena'];\r\n    \r\n            $usuario = new Usuarios();\r\n            if ($usuario->verificarCredenciales($numero_documento, $contrasena)) {\r\n                session_start();\r\n                \r\n                $id_usuario= $usuario->getId();\r\n                $_SESSION['id_usuario']= $id_usuario;\r\n                \r\n                if(isset($_SESSION['id_usuario'])){\r\n                    echo \"<script>\r\n                   \r\n                    window.location.href = 'index.php?vista=funcionario/inicio';\r\n                    ;\r\n                </script>\";\r\n                }else{\r\n                    echo '<script>alert(\"La sesion no esta iniciada\");</script>';\r\n                }\r\n                \r\n              \r\n            } else {\r\n                echo \"<script>\r\n                    console.log('Credenciales incorrectas');\r\n                    Swal.fire({\r\n                        title: 'Credenciales incorrectas',\r\n                        icon: 'error'\r\n                    }).then(function() {\r\n                        window.location.href = 'index.php?vista=usuario/login';\r\n                    });\r\n                </script>\";\r\n            }\r\n        } else {\r\n            include \"./views/usuario/login.php\";\r\n        }\r\n    }\r\n    \r\n\r\n    public function recuperar() {\r\n        session_start(); // Asegúrate de iniciar la sesión\r\n        if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\" && isset($_POST['email'])) {\r\n            $correo = $_POST['email'];\r\n            $usuarioModel = new Usuarios();\r\n            $usuario = $usuarioModel->obtenerUsuarioPorCorreo($correo);\r\n    \r\n            if ($usuario) {\r\n                $_SESSION['reset_email'] = $correo; // Configura la sesión aquí\r\n                $this->enviarCorreoRecuperacion($correo);\r\n                echo \"<script>Swal.fire('Éxito', 'Mensaje enviado con éxito.', 'success');</script>\";\r\n            } else {\r\n                echo \"<script>Swal.fire('Error', 'El correo $correo no existe en la base de datos.', 'error');</script>\";\r\n            }\r\n        }\r\n    \r\n        include \"./views/usuario/recuperar.php\";\r\n    }\r\n\r\n    private function enviarCorreoRecuperacion($correo) {\r\n        require(\"./PHPMailer-master/PHPMailer-master/src/PHPMailer.php\");\r\n        require(\"./PHPMailer-master/PHPMailer-master/src/SMTP.php\");\r\n    \r\n        $mail = new PHPMailer\\PHPMailer\\PHPMailer();\r\n        $mail->IsSMTP();\r\n        $mail->SMTPAuth = true;\r\n        $mail->SMTPSecure = 'ssl';\r\n        $mail->Host = \"smtp.gmail.com\";\r\n        $mail->Port = 465;\r\n        $mail->IsHTML(true);\r\n        $mail->Username = \"easygenz45@gmail.com\";\r\n        $mail->Password = \"aiwi lrnn dsto lmfa\";\r\n        $mail->SetFrom(\"easygenz45@gmail.com\");\r\n        $mail->Subject = \"Restablecer Contraseña\";\r\n        $mail->Body = 'Haz clic en este <a href=\"http://localhost/isaac/index.php?vista=usuario/nuevaC\">enlace</a> para restablecer tu contraseña.';\r\n        $mail->AddAddress($correo);\r\n    \r\n        if (!$mail->Send()) {\r\n            echo \"<script>alert('No se pudo enviar el correo.')</script>\";\r\n        }\r\n    }\r\n\r\npublic function nuevaContrasena() {\r\n    session_start(); // Asegúrate de iniciar la sesión\r\n    if (isset($_SESSION['reset_email'])) {\r\n        if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\r\n            $correo = $_SESSION['reset_email']; // Usa la sesión para obtener el correo\r\n            $nuevaContrasena = $_POST['contra'];\r\n            $nuevaContrasena2 = $_POST['contra2'];\r\n\r\n            if ($nuevaContrasena !== $nuevaContrasena2) {\r\n                echo \"<script>Swal.fire('Error', 'Las contraseñas no coinciden.', 'error');</script>\";\r\n            } else {\r\n                $usuarioModel = new Usuarios();\r\n\r\n                if ($usuarioModel->actualizarContrasena($correo, $nuevaContrasena)) {\r\n                    echo \"<script>Swal.fire('Éxito', 'Contraseña actualizada exitosamente.', 'success');</script>\";\r\n                    echo '<script>window.location.href = \"index.php?vista=usuario/login\";</script>';\r\n                } else {\r\n                    echo \"<script>Swal.fire('Error', 'Error al actualizar la contraseña.', 'error');</script>\";\r\n                }\r\n            }\r\n        }\r\n        include \"./views/usuario/nuevaC.php\";\r\n    } else {\r\n        echo \"<script>Swal.fire('Error', 'Sesión no válida.', 'error');</script>\";\r\n    }\r\n} \r\npublic function obtenerPerfilUsuario($id) {\r\n    return $this->usuarioModel->obtenerUsuarioPorId($id);\r\n}\r\n\r\n\r\npublic function listUsuarios($documento = null, $nombre = null, $apellido = null, $fechaDesde = null, $fechaHasta = null)\r\n{\r\n    $registro = new Registro();\r\n    $usuarios = $registro->getAll($documento, $nombre, $apellido, $fechaDesde, $fechaHasta);\r\n    return $usuarios;\r\n\r\n    \r\n}\r\n\r\n}\r\n\r\n\r\n"
  },
  "models": {
    "Registros.php": "<?php\r\n\r\nrequire_once './config/ConexionBd.php';\r\n\r\nclass Registro\r\n{\r\n    private $conectarse;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->conectarse = new ConexionBd();\r\n    }\r\n\r\n    public function getAll($documento = null, $nombre = null, $apellido = null, $fechaDesde = null, $fechaHasta = null)\r\n    {\r\n        $params = [];\r\n        $sql = \"SELECT id, u.numero_documento, u.nombres, u.apellidos, \r\n                       IFNULL(cf.hora_entrada, isa.hora_entrada) as hora_entrada, \r\n                       IFNULL(cf.hora_salida, isa.hora_salida) as hora_salida, \r\n                       IFNULL(cf.observacion, isa.observacion) as observacion, \r\n                       IFNULL(cf.fecha, isa.fecha) as fecha\r\n                FROM usuarios u\r\n                LEFT JOIN controlfuncionarios cf ON u.id = cf.id_usuario\r\n                LEFT JOIN ingresosalida_ficha isa ON u.id = isa.id_usuario\r\n                WHERE 1=1\";\r\n\r\n        if ($documento) {\r\n            $sql .= \" AND u.numero_documento LIKE ?\";\r\n            $params[] = \"%$documento%\";\r\n        }\r\n\r\n        if ($nombre) {\r\n            $sql .= \" AND u.nombres LIKE ?\";\r\n            $params[] = \"%$nombre%\";\r\n        }\r\n\r\n        if ($apellido) {\r\n            $sql .= \" AND u.apellidos LIKE ?\";\r\n            $params[] = \"%$apellido%\";\r\n        }\r\n\r\n        if ($fechaDesde) {\r\n            $sql .= \" AND IFNULL(cf.fecha, isa.fecha) >= ?\";\r\n            $params[] = $fechaDesde;\r\n        }\r\n\r\n        if ($fechaHasta) {\r\n            $sql .= \" AND IFNULL(cf.fecha, isa.fecha) <= ?\";\r\n            $params[] = $fechaHasta;\r\n        }\r\n\r\n        $stmt = $this->conectarse->conexion->prepare($sql);\r\n        if ($stmt === false) {\r\n            die(\"Error en la preparación: \" . $this->conectarse->conexion->error);\r\n        }\r\n\r\n        // Bind parameters dynamically\r\n        if (!empty($params)) {\r\n            $types = str_repeat('s', count($params));\r\n            $stmt->bind_param($types, ...$params);\r\n        }\r\n\r\n        $stmt->execute();\r\n        $resultado = $stmt->get_result();\r\n        return $resultado;\r\n    }\r\n}\r\n",
    "Usuarios.php": "<?php\r\n\r\nrequire_once './config/ConexionBd.php';\r\n\r\nclass Usuarios\r\n{\r\n    private $id;\r\n    private $nombres;\r\n    private $apellidos;\r\n    private $tipo_documento;\r\n    private $numero_documento;\r\n    private $telefono;\r\n    private $email;\r\n    private $contrasena;\r\n    private $huella;\r\n    private $codigo;\r\n    private $eps;\r\n    private $rh;\r\n    private $contacto_emergencia;\r\n    private $enfermedades;\r\n    private $alergias;\r\n    private $conectarse;\r\n\r\n    //metodos - funciones\r\n\r\n    public function __construct(){\r\n        $this->conectarse = new ConexionBD();\r\n    }\r\n\r\n    //getter y setter\r\n    public function getId(){return $this->id;}\r\n    public function setId($id){$this ->id = $id;}\r\n\r\n    public function getNombres() {return $this->nombres;}\r\n    public function setNombres($nombres) { $this->nombres = $nombres;}\r\n\r\n    public function getApellidos() {return $this->apellidos;}\r\n    public function setApellidos($apellidos) {$this->apellidos = $apellidos;}\r\n\r\n    public function getTipoDocumento() {return $this->tipo_documento;}\r\n    public function setTipoDocumento($tipo_documento) { $this->tipo_documento = $tipo_documento;}\r\n\r\n    public function getNumeroDocumento() {return $this->numero_documento;}\r\n    public function setNumeroDocumento($numero_documento) {$this->numero_documento = $numero_documento;}\r\n\r\n    public function getTelefono() {return $this->telefono; }\r\n    public function setTelefono($telefono) {$this->telefono = $telefono;}\r\n\r\n    public function getEmail() {return $this->email;}\r\n    public function setEmail($email) {$this->email = $email;}\r\n\r\n    public function getContraseña() {return $this->contrasena;}\r\n    public function setContraseña($contrasena) {$this->contrasena = $contrasena;}\r\n\r\n    public function getRh() { return $this->rh; }\r\n    public function setRh($rh) { $this->rh = $rh; }\r\n\r\n    public function getEps() {return $this->eps;}\r\n    public function setEps($eps) {$this->eps = $eps;}\r\n\r\n    public function getContactoEmergencia() {return $this->contacto_emergencia;}\r\n    public function setContactoEmergencia($contacto_emergencia) { $this->contacto_emergencia = $contacto_emergencia;}\r\n\r\n    public function getEnfermedades() {return $this->enfermedades;}\r\n    public function setEnfermedades($enfermedades) {$this->enfermedades = $enfermedades;}\r\n\r\n    public function getAlergias() {return $this->alergias;}\r\n    public function setAlergias($alergias) { $this->alergias = $alergias;}\r\n\r\n    public function listAll(){\r\n        $cadenaSql = \"SELECT * FROM usuarios\";\r\n        $resultado = $this->conectarse->consultaConRetorno($cadenaSql);\r\n        $datos = $resultado->fetch_all();\r\n        return $datos;\r\n    }\r\n\r\n    public function listAllFilter($filters = [])\r\n    {\r\n        $cadenaSql = \"SELECT id, nombres, apellidos, numero_documento FROM usuarios WHERE 1=1\";\r\n\r\n        // Aplicar filtros de búsqueda\r\n        if (!empty($filters['nombre'])) {\r\n            $cadenaSql .= \" AND nombre LIKE '%\" . $this->conectarse->conexion->real_escape_string($filters['nombre']) . \"%'\";\r\n        }\r\n        if (!empty($filters['apellido'])) {\r\n            $cadenaSql .= \" AND apellido LIKE '%\" . $this->conectarse->conexion->real_escape_string($filters['apellido']) . \"%'\";\r\n        }\r\n        if (!empty($filters['numero_documento'])) {\r\n            $cadenaSql .= \" AND numero_documento = '\" . $this->conectarse->conexion->real_escape_string($filters['numero_documento']) . \"'\";\r\n        }\r\n\r\n        $resultado = $this->conectarse->consultaConRetorno($cadenaSql);\r\n        return $resultado->fetch_all(MYSQLI_ASSOC);\r\n    }\r\n\r\n    \r\n    public function insertar()\r\n    {\r\n        $cadenaSql =\r\n        \"INSERT INTO\r\n        usuarios(\r\n         nombres,\r\n         apellidos, \r\n         tipo_documento, \r\n         numero_documento, \r\n         telefono, \r\n         email, \r\n         contrasena, \r\n         rh, \r\n         eps, \r\n         contacto_emergencia, \r\n         enfermedades, \r\n         alergias)\r\n         VALUES\r\n         ('$this->nombres',\r\n          '$this->apellidos', \r\n          '$this->tipo_documento', \r\n          '$this->numero_documento', \r\n          '$this->telefono', \r\n          '$this->email', \r\n          '$this->contrasena', \r\n          '$this->rh', \r\n          '$this->eps', \r\n          '$this->contacto_emergencia', \r\n          '$this->enfermedades', \r\n          '$this->alergias')\";\r\n        $this->conectarse->consultaSinRetorno($cadenaSql);  \r\n    }\r\n\r\n    public function eliminar($id) {\r\n        $id = intval($id);\r\n        $cadenaSql = \"DELETE FROM usuarios WHERE id = $id\";\r\n        $this->conectarse->consultaSinRetorno($cadenaSql);\r\n    }    \r\n    \r\n    public function actualizar() {\r\n        $cadenaSql = \"UPDATE usuarios SET \r\n                nombres = '$this->nombres',\r\n                apellidos = '$this->apellidos',\r\n                tipo_documento = '$this->tipo_documento',\r\n                numero_documento = '$this->numero_documento',\r\n                telefono = '$this->telefono',\r\n                email = '$this->email',\r\n                contrasena = '$this->contrasena',\r\n                rh = '$this->rh',\r\n                eps = '$this->eps',\r\n                contacto_emergencia = '$this->contacto_emergencia',\r\n                enfermedades = '$this->enfermedades',\r\n                alergias = '$this->alergias'\r\n                WHERE id = $this->id\";\r\n        $this->conectarse->consultaSinRetorno($cadenaSql);\r\n    }\r\n\r\n\r\n    public function verificarCredenciales($numero_documento, $contrasena) {\r\n        $conexion = $this->conectarse->conexion;\r\n        \r\n        $sql = \"SELECT * FROM usuarios WHERE numero_documento = ?\";\r\n        $stmt = $conexion->prepare($sql);\r\n\r\n        if (!$stmt) {\r\n            echo \"Error en la preparación: \" . $conexion->error;\r\n            return false;\r\n        }\r\n\r\n        $stmt->bind_param('s', $numero_documento);\r\n        $stmt->execute();\r\n        $result = $stmt->get_result();\r\n\r\n        if (!$result) {\r\n            echo \"Error en la ejecución: \" . $stmt->error;\r\n            return false;\r\n        }\r\n\r\n        $usuario = $result->fetch_assoc();\r\n\r\n        if ($usuario) {\r\n            if ($contrasena === $usuario['contrasena']) {\r\n                $this->id=$usuario['id'];\r\n                return true;\r\n            } else {\r\n                echo \"Contraseña incorrecta\";\r\n                return false;\r\n            }\r\n        } else {\r\n            echo \"Usuario no encontrado\";\r\n            return false;\r\n        }\r\n    }\r\n\r\n    public function obtenerUsuarioPorCorreo($correo) {\r\n        $sql = \"SELECT * FROM usuarios WHERE email = ?\";\r\n        $stmt = $this->conectarse->conexion->prepare($sql);\r\n        $stmt->bind_param(\"s\", $correo);\r\n        $stmt->execute();\r\n        $resultado = $stmt->get_result();\r\n        return $resultado->fetch_assoc();\r\n    }\r\n\r\n    public function actualizarContrasena($email, $nuevaContrasena) {\r\n        $sql = \"UPDATE usuarios SET contrasena = ? WHERE email = ?\";\r\n        $stmt = $this->conectarse->conexion->prepare($sql);\r\n    \r\n        if (!$stmt) {\r\n            echo \"Error en la preparación: \" . $this->conectarse->conexion->error;\r\n            return false;\r\n        }\r\n    \r\n        $stmt->bind_param(\"ss\", $nuevaContrasena, $email);\r\n        \r\n        if (!$stmt->execute()) {\r\n            echo \"Error en la ejecución: \" . $stmt->error;\r\n            return false;\r\n        }\r\n    \r\n        return true;\r\n    }\r\n\r\n    public function obtenerUsuarioPorId($id) {\r\n        $conexion = $this->conectarse->conexion;\r\n        $sql = \"SELECT * FROM usuarios WHERE id = ?\";\r\n        $stmt = $conexion->prepare($sql);\r\n        $stmt->bind_param('i', $id);\r\n        $stmt->execute();\r\n        $result = $stmt->get_result();\r\n        return $result->fetch_assoc();\r\n    }\r\n\r\n    public function obtenerPerfilUsuario($id) {\r\n        $conexion = $this->conectarse->conexion;\r\n        $sql= \"SELECT p.nombre \r\n            FROM perfil p\r\n            INNER JOIN usuario_perfil up ON p.id = up.id_perfil\r\n            WHERE up.id_usuario = ?\";\r\n            \r\n        \r\n        $stmt = $conexion->prepare($sql);\r\n        $stmt->bind_param('i', $id);\r\n        $stmt->execute();\r\n        $result = $stmt->get_result();\r\n        return $result->fetch_assoc();\r\n        \r\n    }\r\n}\r\n    \r\n\r\n\r\n"
  },
  "views": {
    "funcionario": {
      "registros.php": "<?php\r\nsession_start();\r\n$id_usuario = $_SESSION['id_usuario'];\r\nrequire_once './controllers/usuariosController.php';\r\n\r\n\r\n\r\n$usuarioController = new UsuarioController();\r\n\r\n// Obtener los datos del usuario\r\n$datosUsuario = $usuarioController->obtenerPerfilUsuario($id_usuario);\r\n\r\n// Separar nombres y apellidos\r\n$nombres = explode(' ', $datosUsuario['nombres']);\r\n$primerNombre = $nombres[0];\r\n$segundoNombre = isset($nombres[1]) ? $nombres[1] : 'N/A';\r\n\r\n$apellidos = explode(' ', $datosUsuario['apellidos']);\r\n$primerApellido = $apellidos[0];\r\n$segundoApellido = isset($apellidos[1]) ? $apellidos[1] : 'N/A';\r\n\r\n\r\n\r\n?>\r\n\r\n\r\n\r\n\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"UTF-8\" />\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>Aprendiz</title>\r\n    <link rel=\"stylesheet\" href=\"./css/funcionario/registros.css\" />\r\n    <link\r\n      href=\"https://fonts.googleapis.com/css2?family=Material+Icons+Sharp\"\r\n      rel=\"stylesheet\"\r\n    />\r\n    <script src=\"https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js\"></script>\r\n  </head>\r\n  <body>\r\n    <nav class=\"nav\">\r\n      <div class=\"sena\">\r\n        <img src=\"./imagenes/funcionario/logoSena.png\" />Funcionario\r\n      </div>\r\n      <div class=\"menu\">\r\n        <a href=\"?vista=funcionario/inicio\">\r\n        <div>\r\n          <span class=\"material-icons-sharp\">home</span>\r\n          <p>Calendario</p>\r\n        </div>\r\n        </a>\r\n\r\n      </div>\r\n      <div class=\"menu\">\r\n       <a href=\"?vista=funcionario/registros\">\r\n       <div style=\"background: rgb(0, 0, 0, 0.32);\">\r\n          <span class=\"material-icons-sharp\">description</span>\r\n          <p>Registros</p>\r\n        </div>\r\n      </div>\r\n       </a>\r\n\r\n      <div class=\"menu\">\r\n       <a href=\"?vista=funcionario/soporte\"> <div>\r\n          <span class=\"material-icons-sharp\">question_mark</span>\r\n          <p>Soporte</p>\r\n        </div></a>\r\n      </div>\r\n\r\n      <div class=\"menu\">\r\n      <a href=\"?vista=funcionario/inicio\">\r\n      <div>\r\n          <span class=\"material-icons-sharp\">supervisor_account</span>\r\n          <p>Usuarios</p>\r\n        </div>\r\n      </a>\r\n      </div>\r\n\r\n    </nav>\r\n    <div class=\"body\">\r\n      <header class=\"header\">\r\n        <div class=\"title\">\r\n          <p>Control de Registro</p>\r\n        </div>\r\n        <div class=\"perfil\">\r\n          <span class=\"material-icons-sharp\" id=\"perfil\">account_circle</span>\r\n          <div id=\"perfilMenu\" class=\"perfilMenu\">\r\n            <div class=\"perfilIcon\">\r\n              <div>\r\n                <span class=\"material-icons-sharp\">account_circle</span>\r\n                <button class=\"btnBlue\">Cambiar foto</button>\r\n              </div>\r\n\r\n              <div class=\"nameUser\">\r\n                            <h2><?php echo $datosUsuario['nombres']; ?></h2>\r\n                            <h5><?php echo $datosUsuario['email']; ?></h5>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"userData\">\r\n                        <div>\r\n                            <h4>Primer nombre</h4>\r\n                            <h5><?php echo $primerNombre; ?></h5>\r\n                        </div>\r\n                        <div>\r\n                            <h4>Segundo nombre</h4>\r\n                            <h5><?php echo $segundoNombre; ?></h5>\r\n                        </div>\r\n                        <div>\r\n                            <h4>Primer apellido</h4>\r\n                            <h5><?php echo $primerApellido; ?></h5>\r\n                        </div>\r\n                        <div>\r\n                            <h4>Segundo apellido</h4>\r\n                            <h5><?php echo $segundoApellido; ?></h5>\r\n                        </div>\r\n                        <div>\r\n                <h4>N°Documento</h4>\r\n                <h5><?php echo isset($datosUsuario['numero_documento']) ? $datosUsuario['numero_documento'] : 'N/A'; ?></h5>\r\n              </div>\r\n              <div>\r\n                <h4>Telefono</h4>\r\n                <h5><?php echo isset($datosUsuario['telefono']) ? $datosUsuario['telefono'] : 'N/A'; ?></h5>\r\n              </div>\r\n            </div>\r\n            <h3 style=\"text-align: center;\">Datos Medicos</h3>\r\n            <div class=\"userData\">\r\n              <div>\r\n                <h4>EPS</h4>\r\n                <h5><?php echo isset($datosUsuario['eps']) ? $datosUsuario['eps'] : 'N/A'; ?></h5>\r\n              </div>\r\n              <div>\r\n                <h4>RH</h4>\r\n                <h5><?php echo isset($datosUsuario['rh']) ? $datosUsuario['rh'] : 'N/A'; ?></h5>\r\n              </div>\r\n              <div>\r\n                <h4>Contacto de Emergencia</h4>\r\n                <h5><?php echo isset($datosUsuario['contacto_emergencia']) ? $datosUsuario['contacto_emergencia'] : 'N/A'; ?></h5>\r\n              </div>\r\n              <div>\r\n                <h4>Enfermedades</h4>\r\n                <h5><?php echo isset($datosUsuario['enfermedades']) ? $datosUsuario['enfermedades'] : 'N/A'; ?></h5>\r\n              </div>\r\n              <div>\r\n                <h4>Alergias</h4>\r\n                <h5><?php echo isset($datosUsuario['alergias']) ? $datosUsuario['alergias'] : 'N/A'; ?></h5>\r\n              </div>\r\n                    </div>\r\n\r\n            <div class=\"userEnd\">\r\n              <button class=\"btnRed\">Cerrar sesion</button>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </header>\r\n      <main class=\"main\">\r\n        <div class=\"mainLayout\">\r\n        <h1>Registros de Usuarios</h1>\r\n\r\n<form id=\"filterForm\"method=\"get\" action=\"\">\r\n<input type=\"hidden\" name=\"vista\" value=\"funcionario/registros\">\r\n    <label for=\"numero_documento\">Número de Documento:</label>\r\n    <input type=\"text\" id=\"numero_documento\" name=\"numero_documento\" value=\"<?= htmlspecialchars($_GET['numero_documento'] ?? '') ?>\">\r\n    <br>\r\n\r\n    <label for=\"nombres\">Nombre:</label>\r\n    <input type=\"text\" id=\"nombres\" name=\"nombres\" value=\"<?= htmlspecialchars($_GET['nombres'] ?? '') ?>\">\r\n    <br>\r\n\r\n    <label for=\"apellidos\">Apellido:</label>\r\n    <input type=\"text\" id=\"apellidos\" name=\"apellidos\" value=\"<?= htmlspecialchars($_GET['apellidos'] ?? '') ?>\">\r\n    <br>\r\n\r\n    <label for=\"fechaDesde\">Fecha Desde:</label>\r\n    <input type=\"date\" id=\"fechaDesde\" name=\"fechaDesde\" value=\"<?= htmlspecialchars($_GET['fechaDesde'] ?? '') ?>\">\r\n    <br>\r\n\r\n    <label for=\"fechaHasta\">Fecha Hasta:</label>\r\n    <input type=\"date\" id=\"fechaHasta\" name=\"fechaHasta\" value=\"<?= htmlspecialchars($_GET['fechaHasta'] ?? '') ?>\">\r\n    <br>\r\n\r\n    <button type=\"submit\" >Filtrar</button>\r\n    <button type=\"button\" onclick=\"clearFilters()\">Limpiar</button>\r\n</form>\r\n\r\n<table border=\"1\">\r\n    <thead>\r\n        <tr>\r\n        <th id=\"colDocumento\">Documento <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        <th id=\"colNombre\">Nombre <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        <th id=\"colApellido\">Apellido <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        <th id=\"colHoraEntrada\">Hora Entrada <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        <th id=\"colHoraSalida\">Hora Salida <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        <th>Observacion</th>\r\n        <th id=\"colFecha\">Fecha <span class=\"material-icons-sharp\">arrow_drop_down</span></th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n    <?php\r\n    $usuarios = (new UsuarioController())->listUsuarios($_GET['numero_documento'] ?? null, $_GET['nombres'] ?? null, $_GET['apellidos'] ?? null, $_GET['fechaDesde'] ?? null, $_GET['fechaHasta'] ?? null);\r\n    if ($usuarios->num_rows > 0) {\r\n        while ($usuario = $usuarios->fetch_assoc()) { ?>\r\n            <tr onclick=\"mostrarModal(<?= $usuario['id'] ?>)\">\r\n                <td><?=$usuario['numero_documento']?></td>\r\n                <td><?=$usuario['nombres']?></td>\r\n                <td><?=$usuario['apellidos']?></td>\r\n                <td><?=$usuario['hora_entrada']?></td>\r\n                <td><?=$usuario['hora_salida']?></td>\r\n                <td><?=$usuario['observacion']?></td>\r\n                <td><?=$usuario['fecha']?></td>\r\n            </tr>\r\n\r\n            <!-- Modal -->\r\n            <div class=\"modal\" id=\"modal-<?= $usuario['id'] ?>\">\r\n                <div class=\"modal-content\">\r\n                    <span class=\"modal-close\" onclick=\"ocultarModal(<?= $usuario['id'] ?>)\">&times;</span>\r\n                    <div class=\"modal-header\">\r\n                        <h2><?= htmlspecialchars($usuario['nombres']) ?> <?= htmlspecialchars($usuario['apellidos']) ?></h2>\r\n                        <div class=\"perfil\">\r\n                            <?php\r\n                            $perfilUsuario = (new Usuarios())->obtenerPerfilUsuario($usuario['id']);\r\n                            ?>\r\n                            <p>Perfil: <?= htmlspecialchars($perfilUsuario['perfil']) ?></p>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <p>Correo: <?= htmlspecialchars($usuario['email']) ?></p>\r\n                        <p>Teléfono: <?= htmlspecialchars($usuario['telefono']) ?></p>\r\n                        <p>EPS: <?= htmlspecialchars($usuario['eps']) ?></p>\r\n                        <p>Enfermedades: <?= htmlspecialchars($usuario['enfermedades']) ?></p>\r\n                        <p>Alergias: <?= htmlspecialchars($usuario['alergias']) ?></p>\r\n                        <p>RH: <?= htmlspecialchars($usuario['rh']) ?></p>\r\n                        <p>Contacto de emergencia: <?= htmlspecialchars($usuario['contacto_emergencia']) ?></p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        <?php  }\r\n    } else {\r\n        echo \"<tr><td colspan='7'>No se encontraron usuarios.</td></tr>\";\r\n    }\r\n    ?>\r\n</tbody>\r\n</table>\r\n\r\n      </main>\r\n    </div>\r\n\r\n    <script src=\"./js/funcionario/registros.js\"></script>\r\n    <script>\r\n\r\n\r\n    </script>\r\n  </body>\r\n</html>\r\n"
    }
  }
}